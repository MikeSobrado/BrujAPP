<div class="row">
    <div class="col-12">
        <h2 class="text-center mb-4" style="color: var(--brand-primary);">
            <i class="bi bi-graph-up me-2"></i>Monitoreo de Mercado en Tiempo Real
        </h2>
        <p class="text-center text-muted mb-5">
            Monitorea indicadores clave del mercado con datos actualizados autom√°ticamente
        </p>
    </div>
</div>

<div class="graficas-container">
    <!-- Gr√°fica 1: Fear & Greed Index -->
    <div class="grafica-card">
        <h3>Fear & Greed Index</h3>
        <div class="fear-greed-container">
            <div class="fear-greed-main">
                <div class="fear-greed-current">
                    <div id="fear-greed-value">--</div>
                    <div id="fear-greed-classification">Cargando...</div>
                </div>
                <div class="fear-greed-analysis">
                    <div id="fear-greed-pattern-summary">--</div>
                </div>
            </div>
            <div class="fear-greed-chart-container">
                <canvas id="fearGreedChart"></canvas>
            </div>
        </div>
        <div class="grafica-footer">
            <div class="grafica-attribution">Fuente: <a href="https://alternative.me/" target="_blank">alternative.me</a></div>
            <div class="grafica-last-update" id="fear-greed-last-update">--</div>
        </div>
    </div>



    <!-- Gr√°fica 3: Market Dominance -->
    <div class="grafica-card">
        <h3>Dominancia de Mercado</h3>
        <div id="dominance-section">
            <!-- Primera secci√≥n: Valores actuales -->
            <div class="dominance-current-section">
                <div class="dominance-chart-small">
                    <canvas id="dominanceChart"></canvas>
                </div>
                <div class="dominance-crypto-item">
                    <div class="crypto-name">Bitcoin</div>
                    <div class="crypto-dominance" id="btc-dominance">--</div>
                    <div class="crypto-change" id="btc-change">--</div>
                </div>
                <div class="dominance-crypto-item">
                    <div class="crypto-name">Ethereum</div>
                    <div class="crypto-dominance" id="eth-dominance">--</div>
                    <div class="crypto-change" id="eth-change">--</div>
                </div>
                <div class="dominance-crypto-item">
                    <div class="crypto-name">Otros</div>
                    <div class="crypto-dominance" id="others-dominance">--</div>
                    <div class="crypto-change" id="others-change">--</div>
                </div>
            </div>

            <!-- Segunda secci√≥n: Valores hist√≥ricos -->
            <div class="dominance-historical-section">
                <div class="historical-item">
                    <span class="historical-label">Ayer</span>
                    <div class="historical-values">
                        <span id="yesterday-btc">--</span>
                        <span id="yesterday-eth">--</span>
                        <span id="yesterday-others">--</span>
                    </div>
                </div>
                <div class="historical-item">
                    <span class="historical-label">Semana pasada</span>
                    <div class="historical-values">
                        <span id="week-btc">--</span>
                        <span id="week-eth">--</span>
                        <span id="week-others">--</span>
                    </div>
                </div>
                <div class="historical-item">
                    <span class="historical-label">Mes pasado</span>
                    <div class="historical-values">
                        <span id="month-btc">--</span>
                        <span id="month-eth">--</span>
                        <span id="month-others">--</span>
                    </div>
                </div>
            </div>

            <!-- Tercera secci√≥n: M√°ximos y m√≠nimos del a√±o -->
            <div class="dominance-extremes-section">
                <div class="extremes-item">
                    <span class="extremes-label">M√°ximos del a√±o</span>
                    <div class="extremes-values">
                        <span id="max-btc">--</span>
                        <span id="max-eth">--</span>
                        <span id="max-others">--</span>
                    </div>
                </div>
                <div class="extremes-item">
                    <span class="extremes-label">M√≠nimos del a√±o</span>
                    <div class="extremes-values">
                        <span id="min-btc">--</span>
                        <span id="min-eth">--</span>
                        <span id="min-others">--</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="grafica-footer">
            <div class="grafica-attribution">Fuente: <a href="https://coinmarketcap.com/" target="_blank">CoinMarketCap</a></div>
            <div class="grafica-last-update" id="dominance-last-update">--</div>
        </div>
    </div>

    <!-- Gr√°fica 4: Bitcoin Funding Rate -->
    <div class="grafica-card">
        <h3>Bitcoin Funding Rate</h3>
        <div class="funding-container">
            <div id="funding-rate-value">--</div>
            <div id="funding-rate-classification">Cargando...</div>
            <div class="funding-chart-container">
                <canvas id="fundingChart"></canvas>
            </div>
        </div>
        <div class="grafica-footer">
            <div class="grafica-attribution">Fuente: <a href="https://binance.com/" target="_blank">Binance API</a></div>
            <div class="grafica-last-update" id="funding-last-update">--</div>
        </div>
    </div>

    <!-- Gr√°fica 5: Calendario Econ√≥mico -->
    <div class="grafica-card">
        <h3>Calendario Econ√≥mico</h3>
        <!-- TradingView Widget - Carga diferida para evitar conflictos -->
        <div id="tradingview-economic-calendar" style="width: 400px; height: 550px; margin: 0 auto; border: 1px solid #ddd;">
            <div style="text-align: center; padding: 50px; color: #666;">
                üìä Cargando calendario econ√≥mico...
            </div>
        </div>
        <div class="grafica-footer">
            <div class="grafica-attribution">Fuente: <a href="https://tradingview.com/" target="_blank">TradingView</a></div>
            <div class="grafica-last-update">En tiempo real</div>
        </div>
    </div>

</div>

<script>
// Funci√≥n para cargar datos de gr√°ficas desde sessionStorage
// SessionStorage se limpia al cerrar la pesta√±a, NO persiste en reload
function loadChartsFromSession() {
    let chartsData = null;
    
    // Intentar cargar SOLO de sessionStorage (cifrado)
    if (typeof SessionStorageManager !== 'undefined' && SessionStorageManager.getEncryptionKey()) {
        chartsData = SessionStorageManager.loadChartsData();
    }
    
    if (chartsData) {
        console.log('üìÇ Cargando datos de gr√°ficas desde sessionStorage...');
        
        // Cargar Fear & Greed si est√° disponible
        if (chartsData.fearGreed && chartsData.fearGreed.data) {
            setTimeout(() => {
                displayFearGreedData(chartsData.fearGreed.data);
            }, 300);
        }
        
        // Cargar Funding Rate si est√° disponible
        if (chartsData.fundingRate && chartsData.fundingRate.data) {
            setTimeout(() => {
                displayFundingRateData(chartsData.fundingRate.data);
            }, 300);
        }
        
        // Cargar Dominance si est√° disponible
        if (chartsData.dominance && chartsData.dominance.data) {
            setTimeout(() => {
                displayDominanceData(chartsData.dominance.data);
            }, 300);
        }
        
        return true;
    }
    
    return false;
}

// Cargar datos al abrir la pesta√±a
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úì Pesta√±a de gr√°ficas cargada');
    loadChartsFromSession();
});

// Escuchar cuando se activa la pesta√±a de gr√°ficas (cambio de tab)
document.addEventListener('shown.bs.tab', function(e) {
    if (e.target && (e.target.id === 'graficas-tab' || e.target.getAttribute('data-bs-target') === '#graficas')) {
        console.log('‚úì Pesta√±a de gr√°ficas activada');
        loadChartsFromSession();
    }
});
</script>